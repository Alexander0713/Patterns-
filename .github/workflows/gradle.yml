name: Test Bank Application

on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Setup Java 11
      uses: actions/setup-java@v4
      with:
        java-version: '11'
        distribution: 'temurin'
        
    - name: Setup Chrome
      uses: browser-actions/setup-chrome@v1
      
    - name: Make gradlew executable
      run: chmod +x gradlew
      
    - name: Start Bank App
      run: |
        java -jar artifacts/app-ibank.jar -P:profile=test &
        sleep 10
        
    - name: Run Tests
      run: |
        ./gradlew test \
          -Dselenide.headless=true \
          -Dselenide.browser=chrome \
          -Dchromeoptions.args="--no-sandbox,--disable-dev-shm-usage"
